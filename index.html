<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/word.js" defer></script> <!-- 単語機能 -->
    <script src="js/search.js" defer></script> <!-- 検索機能 -->
    <script src="js/history.js" defer></script> <!-- 履歴機能 -->
    <script src="js/share.js" defer></script> <!-- 共有機能 -->
    <script src="js/create.js" defer></script> <!-- HTML動的生成機能 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>topicpot.com</title>
</head>

<header>
    <h1>topicpot.com</h1>
    <p>topicpot is a service that provides up to 100 topics at the same time.</p>
    <p>(topicpotは、最大100個のトピックを同時に提供するサービスです。)</p>
    language(言語)
    <select name="" id="langType" type="texst">
        <option value="en">English</option>
        <option value="fr">français</option>
        <option value="de">Deutsch</option>
        <option value="es">español</option>
        <option value="ja" selected>日本語</option>
        <option value="ru">русский</option>
        <option value="it">italiano</option>
        <option value="zh">中文</option>
    </select>
    column(縦)
    <select name="" id="colNum" type="number">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select>
    Row(横)
    <select name="" id="rowNum" type="number">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select>
    <button id='createPanel'>Let's topicpot !!</button>
</header>

<body>
    <div id='searchPanel' class='searchResult'>
    </div>
    <hr>
    <h2>Recently chosen words(最近選ばれた単語)</h2>
    <hr>
    <h2>Schedule(対応予定)</h2>
</body>
<footer>
    <hr>
</footer>


<script>
    /* 
     * パネル作成
     * @param 列の数
     * @param 行の数
     */
    function createPanel(colNum, rowNum) {
        let htmlText = '<table>';
        for (let col = 0; col < colNum; col++) {
            htmlText += '<tr>'

            for (let row = 0; row < rowNum; row++) {
                htmlText += `
                            <td>
                                <a id='panel_${col}-${row}' href='' target='_blank' rel='noopener noreferrer'></a>
                            </td> `
            }
            htmlText += '</tr>'
        }
        htmlText += '</table>';

        $('#searchPanel').html(htmlText);
    }

    function googleSearch() {
        var keyword = "";
        /* キーワード(エンコード) */
        if (document.form1.keyword.value != "") {
            keyword = encodeURIComponent(document.form1.keyword.value);
        }
        var pram = keyword;
        /* アドレスにパラメータを付加 */
        location.href = "http:google.com/search?q=" + pram;
        return false;
    }

    /*
     * パネル作成
     * @param 列の数
     * @param 行の数
     */
    function getRandomWord(langType, colNum, rowNum) {

        var url = `https://${langType}.wikipedia.org/w/api.php`;

        var params = {
            format: "json",       //JSON形式を指定
            action: "query",      //データ取得のアクションを指定
            generator: "random",  //記事をランダムに取得するよう指定
            list: "random",       //ランダム
            rnnamespace: "0",     //0:標準  https://ja.wikipedia.org/wiki/Help:%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93
            rnlimit: colNum * rowNum,
            prop: "categories"    //記事の基本情報を取得
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function (key) { url += "&" + key + "=" + params[key]; });
        console.log(url);

        fetch(url)
            .then(function (response) {
                return response.json();
            })
            .then(function (response) {
                //onst item = JSON.parse(response);
                console.log(response);
                var randoms = response.query.random;
                for (var r in randoms) {
                    console.log(randoms[r].title);

                }
                //リンク作成
                for (let col = 0; col < colNum; col++) {
                    for (let row = 0; row < rowNum; row++) {
                        console.log(`#panel_${col}-${row}`);
                        $(`#panel_${col}-${row}`).attr('href', 'http:google.com/search?q=' + randoms[col * rowNum + row].title);
                        $(`#panel_${col}-${row}`).text(randoms[col * rowNum + row].title);
                    }
                }




            })
            .catch(function (error) { console.log(error); });
    }
    // 回転ボタン
    $('#btnChangeWord').on('click', function () {
        //wordTest();
        getRandomArticle();
    });
    $('#btnChangeWord2').on('click', function () {
        //wordTest();
        getRandomWord($('#colNum').val() * $('#rowNum').val());
    });
    $('#btnChangeWord3').on('click', function () {
        //wordTest();
        getRandomWiki();
    });
    // 発掘ボタン
    $('#btnStartSearch').on('click', function () {
        createTest();
        wordTest();
        searchTest();
        shareTest();
        historyTest();
    });

    // 過去検索された単語
    $('#btnStartSearch').on('click', function () {

    });

    // 過去発掘されたWEBサイト
    $('#btnStartSearch').on('click', function () {

    });

    // 発掘ボタン
    $('#btnStartSearch').on('click', function () {

    });

    // パネルボタン
    $('#createPanel').on('click', function () {
        //パネル作成
        createPanel($('#colNum').val(), $('#rowNum').val());
        //リンク作成
        getRandomWord($('#langType').val(), $('#colNum').val(), $('#rowNum').val());
    });



</script>

</html>