<!DOCTYPE html>
<html id='htmlLang' lang="ja">
<!-- <html lang="ja"> -->

</html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/history.js"></script> <!-- 履歴機能 -->
    <script src="js/create.js"></script> <!-- HTML動的生成機能 -->
    <script src="js/language.js"></script> <!-- 多言語対応機能 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <title>ToPickPot</title>
</head>

<header>
    <!-- タイトルと説明 -->
    <h1 id='aboutTitle' class='title'>ToPickPot</h1>
    <p id='aboutTopicPot'></p>
</header>

<div class='menuBar'>
    <!-- 言語セレクトフォーム -->
    <p id='aboutLangType'>language</p>
    <select name="selectForm" id="langType" type="texst"></select>

    <!-- 列セレクトフォーム -->
    <p id='aboutColmn'>column</p>
    <select name="selectForm" id="colNum" type="number"></select>

    <!-- 行セレクトフォーム -->
    <p id='aboutRow'>Row</p>
    <select name="selectForm" id="rowNum" type="number"></select>

    <!-- ToPickPotボタン -->
    <button id='createPot'>Let's ToPickPot !!</button>
</div>

<body>
    <!-- ToPickPot表示領域 -->
    <div id='searchPanel' class='searchResult'></div>

    <!-- 検索履歴表示領域 -->
    <h2 id='aboutResent'></h2>
    <button id='deleteHistory'>delete history</button>
    <div id='resentList'></div>

</body>

<footer>
    <hr>
    <table>
        <tr>
            <td>Twitter</td>
            <td>@miniusagi33 </td>
        </tr>
    </table>
</footer>

<script>
    //定数定義
    const COLMAX = 10;
    const ROWMAX = 10;

    //ローカルデータ
    let localData;
    let jsonData;

    //初期設定
    if (localStorage.getItem('localDataJson') === null) {
        //ローカルストレージの初期設定(デフォルトは日本語の3x3)
        localData = {
            lang: '4',      //ページの言語
            col: '3',       //ページの列
            row: '3',       //ページの行
            his: {
                cnt: '0',    //履歴のカウンタ
                max: '100',  //履歴の最大保持数
                // ary: [{      //履歴のオブジェクトの配列
                //     // topic: '',
                //     // lang: '',
                // }],
                ary: [],
            },
        }
        jsonData = JSON.stringify(localData)
        localStorage.setItem('localDataJson', jsonData);
    }
    else {
        //ローカルストレージから読み出し
        jsonData = localStorage.getItem('localDataJson');
        localData = JSON.parse(jsonData);
    }

    //言語設定
    languageChange(localData.lang);

    //言語セレクトフォーム作成
    createLangForm();
    $('#langType').val(localData.lang);

    //列セレクトフォーム作成
    createColForm(COLMAX);
    $('#colNum').val(localData.col);

    //行セレクトフォーム作成
    createRowForm(ROWMAX);
    $('#rowNum').val(localData.row);

    //言語設定とトピックポット作成
    createToPickPot(localData.lang, localData.col, localData.row);

    //検索履歴作成
    if (localData.his.cnt != 0) {
        createSearchHistory();
    }

    // 言語ボタン、列ボタン、行ボタン、変化イベント
    $('#langType,#colNum,#rowNum,#createPot').change('click', function () {

        let colNum = $('#colNum').val();
        let rowNum = $('#rowNum').val();
        let langNo = $('#langType').val();

        //言語設定とトピックポット作成
        createToPickPot(langNo, colNum, rowNum);
    });

    // トピックポットボタン押下イベント
    $('#createPot').on('click', function () {

        let colNum = $('#colNum').val();
        let rowNum = $('#rowNum').val();
        let langNo = $('#langType').val();

        //言語設定とトピックポット作成
        createToPickPot(langNo, colNum, rowNum);
    });

    // 履歴削除ボタン押下イベント
    $('#deleteHistory').on('click', function () {

        //ローカルストレージから読み出し
        let jsonData = localStorage.getItem('localDataJson');
        let localData = JSON.parse(jsonData);

        localData.his.ary = [];

        localData.his.cnt = 0;

        jsonData = JSON.stringify(localData)
        localStorage.setItem('localDataJson', jsonData);

        //検索履歴作成
        createSearchHistory();
    });


    //トピックリンククリックイベント
    $('#searchPanel').on('click', 'a[name="topicLink"]', function () {
        // $('#searchPanel').on('click', 'a[name="topicLink"]', function () {
        // $('#searchPanel a').on('click', function (e) {
        console.log('searchPanelの子孫のa');

        let topic = $(this).text();
        let langNo = $('#langType').val();

        //ローカルストレージから読み出し
        let jsonData = localStorage.getItem('localDataJson');
        let localData = JSON.parse(jsonData);

        let tmp = {
            topic: topic,
            lang: langNo,
        }
        localData.his.ary.unshift(tmp);

        localData.his.cnt++;

        jsonData = JSON.stringify(localData)
        localStorage.setItem('localDataJson', jsonData);

        //検索履歴作成
        createSearchHistory();

    });



</script>

</html>