<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/word.js" defer></script> <!-- 単語機能 -->
    <script src="js/search.js" defer></script> <!-- 検索機能 -->
    <script src="js/history.js" defer></script> <!-- 履歴機能 -->
    <script src="js/share.js" defer></script> <!-- 共有機能 -->
    <script src="js/create.js" defer></script> <!-- HTML動的生成機能 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>発掘.com</title>
</head>
<header>
    <h1>発掘.com</h1>
    <button id="btnChangeWord">axios get</button>
    <button id="btnChangeWord2">fetch</button>
    <button id="btnChangeWord3">ajax</button>
    <input type="text">
    <input type="text">
    <input type="text">
    <button id="btnStartSearch">発掘!</button>
</header>

<body>
    <div class='searchResult'>
        <table>
            <tr>
                <td>
                    <img src="" alt="サムネイル">
                </td>
                <td>
                    <p>URL</p>
                    <p>説明</p>
                </td>
            </tr>
            <tr>
                <td>
                    <img src="" alt="サムネイル">
                </td>
                <td>
                    <p>URL</p>
                    <p>説明</p>
                </td>
            </tr>
        </table>

    </div>
    <hr>
    <h2>最近検索された単語</h2>
    <hr>
    <h2>最近発掘されたWEBサイト</h2>
</body>
<footer>
    <hr>
</footer>


<script>

    function getRandomWiki() {
        //jqueryの関数を利用して、JSONPでwikipediaの記事タイトルをランダムで取得する。
        $.ajax({
            type: "get",
            dataType: "jsonp",
            url: "https://ja.wikipedia.org/w/api.php?action=query&list=random&rnnamespace=0&rnlimit=1&format=json",
            //記事タイトルの取得が成功した時の処理
            success: function (json) {
                //取得したjsonデータ中の記事タイトルを抽出   
                var title = json.query.random[0].title;
                //抽出した記事タイトルの中身を取得すr関数
                getWiki(title);
            }
        });
    }
    function getWiki(query) {
        //引数(query)に指定された記事の中身をhtml形式で取得
        $.ajax({
            type: "get",
            dataType: "jsonp",
            url: "https://ja.wikipedia.org/w/api.php?action=query&format=json&prop=revisions&titles=" + query + "&rvprop=content&rvparse",
            //記事の中身の取得が成功した時の処理(記事の中身を画面に反映するための関数を呼び出す)
            success: parseWiki
        });
    }
    function parseWiki(json) {
        //記事の中身を抽出
        var html;
        for (i in json.query.pages) {
            html = json.query.pages[i].revisions[0]["*"];
        }
        //抽出した記事の内容でid=contentsの要素の中身を書き換える
        document.getElementById("contents").innerHTML = html;
        //記事中のリンク(aタグ)をクリックした時のイベントを設定
        addEventLink();
        //記事中のリンクのリンク先をcontentsのトップに設定
        Array.from(document.querySelectorAll("a"), (e) => {
            e.href = "#contents";
        });
    }

    function getRandomArticle() {

        var url = "https://ja.wikipedia.org/w/api.php";

        var params = {
            action: "query",
            format: "json",
            list: "random",
            rnlimit: "5"
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function (key) { url += "&" + key + "=" + params[key]; });
        console.log(url);

        axios.get(url)
            .then(function (response) {
                // リクエスト成功時の処理(responseに結果が入っている)
                console.log(response);
                var randoms = response.query.random;
                for (var r in randoms) {
                    console.log(randoms[r].title);
                }
            })
            .catch(function (error) {
                // リクエスト失敗時の処理(errorにエラー内容が入っている)
                console.log(error);
            })
            .finally(function () {
                // 成功失敗に関わらず必ず実行
                console.log('done!');
            });
    }

    function getRandomArticle2() {

        var url = "https://ja.wikipedia.org/w/api.php";

        var params = {
            format: "json",         //JSON形式を指定
            action: "query",        //データ取得のアクションを指定
            generator: "random",    //記事をランダムに取得するよう指定
            //grnamespace: "0",     //持ってくる記事の名前空間（分類のようなもの）を0（標準）に設定
            list: "random",
            prop: "info",         //記事の基本情報を取得
            inprop: "url",        //記事のURLも持ってくるよう設定
            //indexpageids,         //ページのIDを付与 これを指定しなければいけない理由は後述
            rnnamespace: "0",       //0:標準  https://ja.wikipedia.org/wiki/Help:%E5%90%8D%E5%89%8D%E7%A9%BA%E9%96%93
            rnlimit: "10"
        };

        url = url + "?origin=*";
        Object.keys(params).forEach(function (key) { url += "&" + key + "=" + params[key]; });
        console.log(url);

        fetch(url)
            .then(function (response) {
                return response.json();
            })
            .then(function (response) {
                console.log(response);
                //onst item = JSON.parse(response);
                console.log(response);
                var randoms = response.query.random;
                for (var r in randoms) {
                    console.log(randoms[r].title);
                }
            })
            .catch(function (error) { console.log(error); });
    }
    // 回転ボタン
    $('#btnChangeWord').on('click', function () {
        //wordTest();
        getRandomArticle();
    });
    $('#btnChangeWord2').on('click', function () {
        //wordTest();
        getRandomArticle2();
    });
    $('#btnChangeWord3').on('click', function () {
        //wordTest();
        getRandomWiki();
    });
    // 発掘ボタン
    $('#btnStartSearch').on('click', function () {
        createTest();
        wordTest();
        searchTest();
        shareTest();
        historyTest();
    });

    // 過去検索された単語
    $('#btnStartSearch').on('click', function () {

    });

    // 過去発掘されたWEBサイト
    $('#btnStartSearch').on('click', function () {

    });

    // 発掘ボタン
    $('#btnStartSearch').on('click', function () {

    });


</script>

</html>